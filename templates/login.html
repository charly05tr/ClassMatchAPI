<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="/static/background.css" rel="stylesheet" />
    <link href="/static/styles.css" rel="stylesheet" />
    <title>Login</title>
</head>

<body>
    <div class="background">
        <ul>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>

        <div id="App"></div>
    </div>

    <script type="text/babel">
        function LoginForm() {
            const [email, setEmail] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [message, setMessage] = React.useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    const res = await fetch("http://localhost:5000/login", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        credentials: "include",
                        body: JSON.stringify({ email, password })
                    });
                    const data = await res.json();
                    if (res.ok) {
                        setMessage("Inicio de sesión exitoso");
                        window.location.href = "/";
                    } else {
                        setMessage(data.error || "Error de autenticación");
                    }
                } catch (err) {
                    setMessage("Error interno del servidor o de conexión");
                }
            };

            return (
                <div className="container d-flex justify-content-center align-items-center min-vh-100">
                    <div className="card shadow p-4 log-card">
                        <div className="centrar">
                            <div className="imapeque">
                                <img src="static/logoph.png" />
                            </div>
                        </div>

                        <div className="centrar mb-3">
                            <a  className='no-cuenta-a'href="/registro">¿No tienes cuenta?</a>
                        </div>

                        <form onSubmit={handleSubmit}>
                            <div className="mb-3">
                                <label htmlFor="email" className="form-label">Correo electrónico</label>
                                <input id="email" type="email" className="form-control" placeholder="Email" value={email} onChange={(e) => setEmail(e.target.value)} required />
                            </div>

                            <div className="mb-3">
                                <input id="password" type="password" className="form-control" placeholder="••••••••" value={password} onChange={(e) => setPassword(e.target.value)} required />
                            </div>

                            <div className="centrar mb-3">
                                <a className='no-cuenta-a' href="#">Olvidé mi contraseña</a>
                            </div>

                            <button type="submit" className="btn btn-secondary w-100 mb-3">Iniciar sesión</button>
                            <h4 className="centrar mb-3">o</h4>
                            <button className="btn btn-secondary w-100 mb-2" type="button"><img src="static/googlelogo.png" className="logosminis" />Continuar con Google</button>
                            <button className="btn btn-secondary w-100 mb-2" type="button"><img src="static/githublogo.png" className="logosminis" />Continuar con GitHub</button>
                        </form>
                        {message && <p className="text-center mt-3">{message}</p>}
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById("App")).render(<LoginForm />);
    </script>
</body>
</html>
